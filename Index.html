<p>///7.1 Parameters</p>
<p>//Non-parametric</p>
<p>cls //1. data global repo &ldquo;<a href="https://github.com/jhustata/project/raw/main/">https://github.com/jhustata/project/raw/main/</a>&rdquo; global nhanes &ldquo;<a href="https://wwwn.cdc.gov/Nchs/Nhanes/">https://wwwn.cdc.gov/Nchs/Nhanes/</a>&rdquo;</p>
<p>//2. code do ${repo}followup.do save followup, replace import sasxport5 &ldquo;${nhanes}1999-2000/DEMO.XPT&rdquo;, clear merge 1:1 seqn using followup, nogen save survey_followup, replace</p>
<p>//3. parameters import sasxport5 &ldquo;${nhanes}1999-2000/HUQ.XPT&rdquo;, clear tab huq010 merge 1:1 seqn using survey_followup, nogen keep(matched) rm followup.dta rm survey_followup.dta g years=permth_int/12 stset years, fail(mortstat) replace huq010=. if huq010==9 label define huq 1 &ldquo;Excellent&rdquo; 2 &ldquo;Very Good&rdquo; 3 &ldquo;Good&rdquo; 4 &ldquo;Fair&rdquo; 5 &ldquo;Poor&rdquo; label values huq010 huq levelsof huq010, local(numlevels) local i=1 foreach l of numlist <code>numlevels' { local vallab: value label huq010 local catlab: lab</code>vallab&rsquo; <code>l' global legend</code>i&rsquo; = &quot;<code>catlab'&quot; local i=</code>i&rsquo; + 1 } save week7, replace sts graph, /// by(huq010) /// fail /// per(100) /// ylab(0(20)80 , /// format(%2.0f) /// ) /// xlab(0(5)20) /// tmax(20) /// ti(&ldquo;Self-Reported Health and Mortality&rdquo;) /// legend( /// order(5 4 3 2 1) /// lab(1 &ldquo;$legend1&rdquo;) /// lab(2 &ldquo;$legend2&rdquo;) /// lab(3 &ldquo;$legend3&rdquo;) /// lab(4 &ldquo;$legend4&rdquo;) /// lab(5 &ldquo;$legend5&rdquo;) /// ring(0) pos(11) /// ) graph export nonpara.png, replace</p>
<p>///7.2 Inferences hist ridageyr graph export nonpara.png, replace //replace ridageyr=ridageyr/10 capture drop s0 stcox i.huq010 ridageyr riagendr, basesurv(s0) return list matrix define mat_adj=r(table) matrix define mat_adj=mat_adj&rsquo; matrix list mat_adj svmat mat_adj keep mat_adj* drop if missing(mat_adj1) rename (mat_adj1 mat_adj2 mat_adj3 mat_adj4 mat_adj5 mat_adj6 mat_adj7 mat_adj8 mat_adj9)(b se z p ll ul df crit eform) g x=_n replace b=log(b) replace ll=log(ll) replace ul=log(ul) twoway (scatter b x if inrange(x,1,5)) || /// (rcap ll ul x if inrange(x,1,5), /// yline(0, lcol(lime)) /// ylab( /// -2.08 &ldquo;0.125&rdquo; /// -1.39 &ldquo;0.25&rdquo; /// -.69 &ldquo;0.5&rdquo; /// 0 &ldquo;1&rdquo;  /// .69 &ldquo;2&rdquo; /// 1.39 &ldquo;4&rdquo; /// 2.08 &ldquo;8&rdquo; /// 2.78 &ldquo;16&rdquo;) /// legend(off)  /// xlab( /// 1 &ldquo;$legend1&rdquo; /// 2 &ldquo;$legend2&rdquo; /// 3 &ldquo;$legend3&rdquo; /// 4 &ldquo;$legend4&rdquo; /// 5 &ldquo;$legend5&rdquo;) /// xti(&ldquo;Self-Reported Health&rdquo;) /// ) graph export semipara_adj.png, replace graph save semipara_adj.gph, replace</p>
<p>///7.3 Updates graph combine semipara_unadj.gph semipara_adj.gph, /// ycommon ti(&ldquo;Hazard Ratio, 95%CI&rdquo;) graph export unadj_adj.png, replace //these variable names don&rsquo;t exist in the dataset, this is a mere demo di &ldquo;What do you wish to adjust for in this analysis?&rdquo; _request($varlist) capture program drop selfassess program define selfassess syntax varlist stcox i.huq010 `varlist&rsquo; end selfassess $varlist</p>
<p>///7.4 Transparency</p>
<p>///7.5 Extracting Parameters cls use week7, clear</p>
<p>///e(b) cls use week7, clear replace riagendr=riagendr-1 stcox i.huq010 ridageyr riagendr, basesurv(s0) keep s0 _t _t0 _st _d save s0, replace ereturn list matrix beta = e(b) matrix vcov = e(V) matrix SV = ( /// 0, /// 1, /// 0, /// 0, /// 0, /// 40, /// 1 /// ) matrix SV_ref = ( /// 0, /// 1, /// 0, /// 0, /// 0, /// 60, /// 1 /// ) //absolute risk matrix risk_score = SV * beta&rsquo; matrix list risk_score di exp(risk_score[1,1]) matrix var_prediction = SV * vcov * vcov&rsquo; matrix se_prediction = sqrt(var_prediction[1,1])</p>
<p>matrix risk_score_ref = SV_ref * beta&rsquo; matrix list risk_score_ref di exp(risk_score_ref[1,1]) matrix var_prediction_ref = SV_ref * vcov * vcov&rsquo; matrix se_prediction_ref = sqrt(var_prediction_ref[1,1])</p>
<p>local hr = exp(risk_score_ref[1,1])/exp(risk_score[1,1]) di `hr&rsquo;</p>
<p>//di &ldquo;We conclude that `exp(risk_score[1,1])&rsquo;&rdquo;</p>
<p>// g f0 = (1 - s0) * 100 g f1_ = f0 * exp(risk_score[1,1]) line f1 _t , ///<br />
sort connect(step step) /// legend(ring(0)) /// ylab(0(5)20) xlab(0(5)20) /// yti(&quot;&quot;) /// ti(&ldquo;Scenario, %&rdquo;, pos(11)) /// xti(&ldquo;Years&rdquo;) /// note(&ldquo;40yo male who self-describes as being in good health&rdquo; /// ,size(1.5) /// ) graph export scenario.png, replace</p>
